Information and cheats on Rails.

Live version of the application app at: <http://cirosantilli-rails-cheat.herokuapp.com/>

You can deploy your own instance instantly with:

    ./heroku-deploy.sh appname

Certain features of the app may break on that deployment such as file uploads due to the ephemeral FS.
This could be corrected by using something like FTP or AWS.

#ubuntu install

Install Rails on Ubuntu with RVM:
<https://www.digitalocean.com/community/articles/how-to-install-ruby-on-rails-on-ubuntu-12-04-lts-precise-pangolin-with-rvm>

Should work for most other Linux distros as well.

The line which has been put on `~/.bash_profile` should be moved to `~/.bashrc`.

Will also need nodejs:

    sudo aptitude install nodejs

#config

- `application.rb` and environments under `environments`.

    Basic configuration of Rails built-in things.

- `config/initializers`:

    Configurations of things which are not built-in rails,
    such as installed gems.

#rails command

Create a new project template:

    rails new project-name

Use a specific RDMS

    rails new myapp --database=postgresql

Run test server:

    cd project-name
    rails server

Shortcut:

    rails s

By default this serves on port `3000`.

Generate a controller template with one action:

    rails generate controller controller-name action-name

Shortcut:

    rails g controller controller-naue action-name

Delete files created with generate:

    rails destroy controller controller-name

Shortcut:

    rails d controller controller-name

#rake

`rake` is the standard way to create new commands to be used interactively.

To create a new rake task add a `.rake` file with any name under `lib/tasks` in Rakefile format.

#controller

Controllers take user inputs (HTTP requests) and return the expected data page.

Controllers are classes. They live under `app/controller`.

#action

Actions are controller methods.

Each URL maps to an action which takes care of it.

The view for an action named `action0` (the name of the method)
of the controller class named Controller0
automatically corresponds to the `erb` file `app/views/controller0/action0.html.erb`.

Any instance variable defined in the function as `@var0`
becomes available to its corresponding `erb` as `@var0`.

#routes

Determine which action to take for each URL.

Config file: `app/config/routes.rb`

To view all the routes, run:

    rake routes

#model

See active records.

#active records

Name for the RoR provided ORM.

A model is a class that will map to a database table.
Models inherit from `ActiveRecord::Base`.

Models are defined by:

- `db/schema.rb`: defines the columns and DBMS properties of the database.
    This file is automatically generated by the migrations, so don't modify it.

- `app/models`: can define properties of models that are not database implemented
    such as Ruby implemented validation.

Create a new model template:

    rails generate model model_name

or

    rails generate model ModelName

In both cases above the class will by default be named `ModelName`
and the table `model_name`.

This will also create a db migration and test fixtures templates.

Create a template with some fields:

    rails generate model model_name column0:string column1:string

#database

Database connection is configured at the file `config/database.yml`
which is a YAML file.

- `adapter`: database type. Most common values: `sqlite3` (default), `mysql` and `postgresql`
- `username`: if not present, Rails tries to use the current username to log into the database.

##databases

By convention RoR application development uses 3 databases:

- `development`. Used for runnings app tests manually on a browser.

    This database is used by default when using `rails serve`.

- `test`. Used for unit tests. Erased every time a new unit test will be run via `rake test`.

- `production`. The actual database that end users will see.

    To use this database with the rails some options follow.

    Command line argument (preferred if possible):

        rails serve -e production

    Environment variable:

        RAILS_ENV=production rails serve

    or:

        export RAILS_ENV=production
        rails serve

##create

Once the database connection is configured, create current database (`Rails.env`):

    rake db:create

Create all databases (e.g. development, test and produciton):

    rake db:create:all

Create only the production database:

    RAILS_ENV=production rake db:create

This does not automatically migrate. Now you should:

    rake db:migrate

This will also update the schema under `db/schema.rb`.

Load the schema under `db/schema.rb`, creating it on an existing db:

    rake db:schema:load

This is useful after migrations have already been done and `db/schema.rb`
is already up to date. In that case, this command can be much faster than
`db:migrate`, since only a single operation is done.

Populate the database with its initial data for a new app installation:

    rake db:seed

This data is defined under `db/seed.rb`.

Create db, load schema and seed data all in one:

    rake db:setup

It's weird, but at Rails 4 this also drops the `db` first just like `db:reset`.

This is a good option to start a database to its working condition once
migrations have already made `db/schema.rb` be up to date, for example
to reset a development database after a `db:drop`.

Its weird, but as of 2013 this seems to also drop first!

Same as setup, but drop first:

    rake db:reset

Great to turn a development database to its initial state.

##dbconsole

Log into the REPL of the RDMS used by the current application:

    rails dbconsole

The database must exist.

Alias:

    rails db

##migration

Migrations are specifications of how databases should change.

Migrations have two components:

- ruby classes derived from `ActiveRecord::Migration` in files under `db/migrate`
    which describe in ruby how the migration should happen

- database information which stores migration metadata.

Migration templates can be generated with:

    rails generate migration MigrationName

Certain migration names are special and lead to better template creation.

For example, any name of the form `Add<column_name>To<table_name>` already
adds a table addition to the generated template. Example:

    rails generate migration AddColumnNameToTableName column_name:string

will create a migration template that adds
a string column named `column_name` to table TableName.

Other standard migration generate names follow.

Remove column from table:

    rails generate migration RemovePartNumberFromProducts part_number:string

Create a new table:

    rails generate migration CreateProducts name:string part_number:string

You will probably want to leave this to a `generate model` command.

List all migrations, including where we currently are:

    rake db:status

Apply all migrations up to the most recent:

    rake db:migrate

Go back to last migration:

    rake db:rollback

##fixture

TODO vs seed.

#scaffold

Automatically generates a base CRUD interface for a model.

    rails generate scaffold ModelName

#tests

Load test data on the test db.

Create the test db from the current `db/schema.rb`:

    rake db:test:load

Run all the tests:

    rake test

To run the tests do:

    rake test tests/models/${MODEL_NAME}.rb

Run all unit tests:

    rake test:units

Run all functional tests:

    rake test:functionals

Run all integration tests:

    rake test:integration

Run all tests in a given file:

    rake test TEST=test/models/model0_test.rb

Run a single test method:

    ruby -I"lib:test" test/models/model0_test.rb -n name_of_the_method"

Run all tests matching a given regexp in given file:

    ruby -I"lib:test" test/unit/invitation_test.rb -n /.*between.*/

##mail

##email

##action mailer

Quickstart:

    rails generate mailer MyMailer

Generates:

    app/mailers/my_mailer.rb
    app/views/my_mailer/
    test/mailers/my_mailer_test.rb

SMPT configuration under `config/initializers/smtp_settings.rb`:

    App::Application.config.action_mailer.delivery_method = :smtp
    ActionMailer::Base.smtp_settings = {
      address:              'smtp.gmail.com',
      port:                 587,
      domain:               'gmail.com',
      user_name:            'user@gmail.com',
      password:             'pass',
      authentication:       'plain',
      enable_starttls_auto: true
    }

Create a `.example` version and Gitignore it to protect the password.

#lib

Is put on the Ruby require path.

##lib/tasks

All `.rake` files in this dir are searched for rake commands.

#initializers

Are automatically required on all files of the application.

#devise

User signup and authentication.

Gemfile: `gem devise`.

    rails generate devise:install
    rails generate devise:views
    rails generate devise User

where `User` is the model that will represent the user.

##email confirmation

Get action mailer working.

`app/models`: uncomment `:confirmable`

Migration file: uncomment the `:confirmable` section.

`config/initializers/devise.rb`:

- config.mailer = 'Devise::Mailer'

##unregistered users

Just don't add:

    before_filter: authenticate!

and unauthenticated users can view pages normally.

---

rake db:migrate

Restart rails.

##omniauth
